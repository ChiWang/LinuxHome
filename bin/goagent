#! /bin/bash
#=====================================================================
#   File:   goagent
#   Author: Chi WANG  (chiwang@mail.ustc.edu.cn)    18/09/2013
#---------------------------------------------------------------------
#   Description:
#
#   control of goagent. 
#   By using of command "goagent" with arguments "on" OR "off"
#---------------------------------------------------------------------
#   History:
#                           Last update:  13/12/2013   13:58:44
#=====================================================================

PS="/bin/ps auwx"
GOAGENT_LOCAL=$HOME/software/goagent_v3.0          # where your software

if [ -d $GOAGENT_LOCAL ];then
    MASTER=$GOAGENT_LOCAL/local/proxy.py
else
    echo "$GOAGENT_LOCAL not found. Skipping goagent startup."
    exit 1
fi

case $1 in
'on')
    pid=`$PS | grep proxy.py | grep -v grep | awk '{print $2}'`
    if [ -n "$pid" ] ;then
        echo "goagent is already running."
        exit 1
    fi

    if [ -e $MASTER ];then
        echo "Starting up goagent"
        nohup python $MASTER >/dev/null 2>&1 &
    else
        echo "$MASTER is not exist. Skipping goagent startup."
        exit 1
    fi
    ;;

'off')
    pid=`$PS | grep proxy.py | grep -v grep | awk '{print $2}'`
    if [ -n "$pid" ]; then
        echo "Shutting down goagent."
        kill $pid       # normal user. if root: kill -9 $pid
    else
        echo "goagent is not running."
    fi
    ;;

*)
    echo "Usage: goagent {on|off}"
    ;;

esac


